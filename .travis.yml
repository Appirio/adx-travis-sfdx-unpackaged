sudo: true
os: linux
cache: false
language: generic

before_script:
- export adx_dir=adx-cli
- git fetch --depth=10000
- wget https://appiriodx-cli-dev.s3.us-east-2.amazonaws.com/dev-adx-135813-linux -P $adx_dir
- (cd $adx_dir && mv dev-adx-135813-linux adx && chmod 777 adx)
- export PATH=$(pwd)/$adx_dir:$PATH

stages:
  - name: sonarqube_scan
    if: tag IS blank

jobs:

  include:

      - stage: sonarqube_scan
        name: sonarqube_scan
        before_script:
          - export sonar_dir=sonarqube
          - wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.4.0.2170-linux.zip -P $sonar_dir
          - (cd $sonar_dir && unzip sonar-scanner-cli-4.4.0.2170-linux.zip)
          - export PATH=$(pwd)/$sonar_dir/sonar-scanner-4.4.0.2170-linux/bin:$PATH
        script:
          - adx test:execute --command="sonar-scanner -Dsonar.login='$SONAR_LOGIN' -Dsonar.qualitygate.wait=true" --tool=SonarQube --monitoralias=TEST
